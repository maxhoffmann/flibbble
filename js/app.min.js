(function(t,n,r){"use strict";var i,s,o=function(){n.body.ontouchmove=function(e){e.preventDefault()};n.body.innerHTML='<div id="notifications"><span id="notification"></span></div><div id="menu" class="screen"><ul id="navigation"><li class="logo">flibbble</li><li data-open="#/popular">Popular</li><li data-open="#/following">Following</li><li data-open="#/likes">Likes</a></li><li data-open="#/debuts">Debuts</li><li data-open="#/everyone">Everyone</li></ul></div><div id="flipper" class="screen"></div>';i=n.getElementById("flipper");var e=function(){u.to()};t.addEventListener("hashchange",e,!1);t.addEventListener("orientationchange",c,!1);u.enable();u.to();f.enable();l.enable();h.enable()},u=function(){var e,t=!1,r,i,s=0,o=function(){var t=this;r=location.hash.slice(2).split("/")[0]||r;i=location.hash.slice(2).split("/")[1]||i;this.page=this.page?1:+localStorage.getItem("page");s=s?1:+localStorage.getItem("position")||1;switch(r){case"shots":e="http://api.dribbble.com/players/"+i+"/"+r+"/";break;case"following":case"likes":i=i||prompt("dribbble username:",i);e="http://api.dribbble.com/players/"+i+"/shots/"+r;break;case"popular":case"debuts":case"everyone":e="http://api.dribbble.com/shots/"+r;i=null;break;default:e="http://api.dribbble.com/shots/popular";r="popular";i=null}p.get(e,{per_page:20,page:this.page},c)},c=function(e){if(e.shots.length>0){f.position=s;u.page=e.page;u.pages=e.pages;a(e,"insert");l.center();h.show(r,i);localStorage.setItem("section",r);localStorage.setItem("page",u.page);localStorage.setItem("player",i);localStorage.setItem("position",s)}},d=function(){var e=n.getElementById("navigation");r=localStorage.getItem("section")||"popular";i=localStorage.getItem("player");for(var t=1;t<e.children.length;t++){e.children[t].addEventListener("touchstart",u.activate,!1);e.children[t].getAttribute("data-open").slice(2)===r&&e.children[t].classList.add("active")}},v=function(){n.getElementsByClassName("active")[0]&&n.getElementsByClassName("active")[0].classList.remove("active");this.classList.add("active");i=null;location.hash=this.getAttribute("data-open")},m=function(n){if(!t){if(n==="append"&&this.page<this.pages){t=!0;p.get(e,{per_page:20,page:this.page+1},function(e){a(e,n);t=!1})}if(n==="prepend"&&this.page>1){t=!0;p.get(e,{per_page:20,page:this.page-1},function(e){a(e,n);f.position+=10;t=!1})}}};return{page:0,pages:1,to:o,more:m,enable:d,activate:v}}(),a=function(){var e=n.createElement("div"),t=n.createElement("div");e.className="drag up";e.innerHTML='<span class="arrow">&#8593;</span>drag up for more shots';t.className="drag down";t.innerHTML='<span class="arrow">&#8595;</span>drag down for more shots';return function(r,o){var u=r.shots.length,a=n.createDocumentFragment(),l=0,c=function(){var e=f.position;for(;l<u;l++){var t=n.createElement("div");t.classList.add("page");o==="prepend"&&t.classList.add("up");if(l===0&&o!=="append"){t.appendChild(h(l));t.classList.add("up");o==="insert"&&Math.floor((l+1)/2)===e-1&&t.classList.add("visible");t.firstChild.classList.add("back");a.appendChild(t)}if(l===0&&o==="append"){s[s.length-1].appendChild(h(0));s[s.length-1].lastChild.classList.add("back")}if(l>0&&l<u-1){(Math.floor((l+1)/2)===e-1||Math.floor((l+1)/2)===e)&&o==="insert"&&t.classList.add("visible");Math.floor((l+1)/2)<e&&o==="insert"&&t.classList.add("up");t.appendChild(h(l));l++;t.appendChild(h(l));t.firstChild.classList.add("front");t.lastChild.classList.add("back");a.appendChild(t)}if(l===u-1)if(o==="prepend"){s[0].insertBefore(h(l),s[0].firstChild);s[0].firstChild.classList.add("front")}else{if(u%2===0){o==="insert"&&Math.floor((l+1)/2)===e&&t.classList.add("visible");t.appendChild(h(l));t.firstChild.classList.add("front")}else{u>1&&a.appendChild(t);t=n.createElement("div");t.classList.add("page");o==="insert"&&Math.floor((l+1)/2)===e-1&&t.classList.add("visible");t.innerHTML+='<div class="front text">END</div>'}a.appendChild(t)}}},h=function(e){var t=n.createElement("div"),i=n.createElement("div"),s=n.createElement("img"),o=n.createElement("div"),u=n.createElement("div"),a=n.createElement("a"),f=n.createElement("img"),l=n.createElement("div"),c=function(){i.removeChild(l)};l.className="loading";l.innerHTML='<div class="loading-title">'+r.shots[e].title+'</div><div class="loading-author">by '+r.shots[e].player.name+"</div>";i.appendChild(l);i.className="shot";s.className="hidden";s.height=240;s.width=320;s.src=r.shots[e].image_url;s.addEventListener("load",function h(){s.classList.remove("hidden");setTimeout(c,600);s.removeEventListener("load",h)},!1);o.className="details";o.innerHTML='<h2 class="title"><a href="'+r.shots[e].url+'">'+r.shots[e].title+"</a></h2>";o.innerHTML+='<div class="meta"><span class="likes"></span>'+r.shots[e].likes_count+' <span class="views"></span>'+r.shots[e].views_count+' <span class="comments"></span>'+r.shots[e].comments_count+"</div>";u.className="author";a.className="author-image";a.href="#/shots/"+r.shots[e].player.username;a.setAttribute("data-src",r.shots[e].player.avatar_url);u.appendChild(a);u.innerHTML+='<a href="#/shots/'+r.shots[e].player.username+'" class="author-name">'+r.shots[e].player.name+'</a><br><span class="author-links"><a href="#/following/'+r.shots[e].player.username+'">Following</a> &bull; <a href="#/likes/'+r.shots[e].player.username+'">Likes</a></span>';o.appendChild(u);i.appendChild(s);t.appendChild(i);t.appendChild(o);return t};c();o==="insert"&&(i.innerHTML="");o==="prepend"?i.insertBefore(a,i.firstChild):i.appendChild(a);r.page===1&&t.parentNode&&i.removeChild(t);r.page>1&&(o==="insert"||t.parentNode)&&i.insertBefore(t,i.firstChild);r.page===r.pages&&e.parentNode&&i.removeChild(e);r.page<r.pages&&(o==="insert"||e.parentNode)&&i.insertBefore(e,i.firstChild);s=n.getElementsByClassName("page");if(o==="append"&&s.length>51){var p=0;while(p++<10)i.removeChild(s[0]);s[0].removeChild(s[0].firstChild);f.position-=10;i.insertBefore(t,i.firstChild)}if(o==="prepend"&&s.length>51){var d=0,v=(s.length+9)%10||10;while(d++<v)i.removeChild(s[s.length-1]);s[s.length-1].removeChild(s[s.length-1].lastChild);i.insertBefore(e,i.firstChild)}}}(),f=function(){var e,t,n,r,o,a,c,h=function(e){t=e.targetTouches[0].pageY;n=e.targetTouches[0].pageX;r=0;o=0;a=0;c=(new Date).getTime()},p=function(e){e.preventDefault();r=t-e.targetTouches[0].pageY;o=n-e.targetTouches[0].pageX;if(r>0&&Math.abs(o)<Math.abs(r)){l.disable();if(f.position===s.length-1){a=Math.max(-(-Math.log(r)*25+75),1);u.page<u.pages&&(a>60?i.querySelector(".up").firstChild.classList.add("load"):i.querySelector(".up").firstChild.classList.remove("load"))}else{a=Math.min(Math.max((r-20)*.485,1),180);s[f.position+1].classList.add("visible")}s[f.position].style.webkitTransform="rotateX("+a+"deg)";s[f.position].style.webkitTransition="none";s[f.position-1].style.webkitTransition="";s[f.position-1].style.webkitTransform="";f.position>1&&s[f.position-2].classList.remove("visible")}if(r<0&&Math.abs(o)<Math.abs(r)){l.disable();if(f.position===1){a=Math.min(180+(-Math.log(-r)*25+75),179);u.page>1&&(a<120?i.querySelector(".down").firstChild.classList.add("load"):i.querySelector(".down").firstChild.classList.remove("load"))}else{a=Math.max(Math.min((380+r)*.485,180),1);s[f.position-2].classList.add("visible")}s[f.position-1].style.webkitTransform="rotateX("+a+"deg)";s[f.position-1].style.webkitTransition="none";s[f.position].style.webkitTransition="";s[f.position].style.webkitTransform="";f.position<s.length-1&&s[f.position+1].classList.remove("visible")}},d=function(t){var n=(new Date).getTime()-c;e=f.position;if(a>=90&&(n>500||Math.abs(o)>Math.abs(r)||f.position===1)&&r<0){s[f.position-1].style.webkitTransition="";s[f.position-1].style.webkitTransform="";s[f.position-1].classList.add("up");f.position-2>=0&&s[f.position-2].classList.remove("visible");a<120&&f.position===1&&u.more("prepend")}if(a<90&&(n>500||f.position===s.length-1||Math.abs(o)>Math.abs(r))&&r>0){s[f.position].style.webkitTransition="";s[f.position].style.webkitTransform="";f.position<s.length-1&&s[f.position+1].classList.remove("visible");if(f.position===s.length-1){s[f.position-1].style.webkitTransition="";s[f.position-1].style.webkitTransform="";a>60&&f.position===s.length-1&&u.more("append")}}if((a>=90||n<=500)&&r>0&&f.position<s.length-1&&Math.abs(o)<Math.abs(r)){s[f.position].style.webkitTransition="";s[f.position].style.webkitTransform="";s[f.position].classList.add("up");f.position-1>=0&&s[f.position-1].classList.remove("visible");f.position++}if((a<90||n<500)&&r<0&&f.position!==1&&Math.abs(o)<Math.abs(r)){s[f.position-1].style.webkitTransition="";s[f.position-1].style.webkitTransform="";s[f.position-1].classList.remove("up");f.position<s.length-1&&s[f.position+1].classList.remove("visible");s[f.position].classList.remove("visible");f.position--}c=0;if(f.position%10===0&&e===f.position+1){u.page--;localStorage.setItem("page",u.page)}if((f.position-1)%10===0&&e===f.position-1){u.page++;localStorage.setItem("page",u.page)}localStorage.setItem("position",f.position%10||10);l.enable()},v=function(){i.addEventListener("touchstart",h,!1);i.addEventListener("touchmove",p,!1);i.addEventListener("touchend",d,!1)},m=function(){i.removeEventListener("touchstart",h);i.removeEventListener("touchmove",p);i.removeEventListener("touchend",d)};return{enable:v,disable:m,position:1}}(),l=function(){var e,t,r,s,o="center",u=function(n){e=n.targetTouches[0].pageY;t=n.targetTouches[0].pageX;r=0;s=0},a=function(n){n.preventDefault();r=e-n.targetTouches[0].pageY;s=t-n.targetTouches[0].pageX},l=function(e){if(o==="center"&&Math.abs(s)>Math.abs(r)&&s>50){var t=!1;e.target.parentNode.classList.contains("shot")&&(t=e.target.parentNode);e.target.classList.contains("shot")&&(t=e.target);if(t){t.classList.add("left");t.parentNode.addEventListener("touchend",c,!1)}var i=e.target.parentNode.parentNode.querySelector(".author-image");if(i.hasAttribute("data-src")){var u=n.createElement("img");u.width="50";u.height="50";u.className="hidden";u.src=i.getAttribute("data-src");i.appendChild(u);i.removeAttribute("data-src");u.addEventListener("load",function a(){u.classList.remove("hidden");u.removeEventListener("load",a)},!1)}}o==="center"&&Math.abs(s)>Math.abs(r)&&s<-50&&!n.body.classList.contains("landscape")&&(e.target.classList.contains("shot")&&!e.target.classList.contains("left")||e.target.parentNode.classList.contains("shot")&&!e.target.parentNode.classList.contains("left")||e.target.classList.contains("text"))&&h();o==="right"&&Math.abs(s)>Math.abs(r)&&s>0&&p()},c=function(e){if(o==="center"&&Math.abs(s)>Math.abs(r)&&s<-50){this.children[0].classList.remove("left");e.stopPropagation();this.removeEventListener("touchend",c)}},h=function(){i.classList.add("right");f.disable();o="right"},p=function(){i.classList.remove("right");f.enable();o="center"},d=function(){i.addEventListener("touchstart",u,!1);i.addEventListener("touchmove",a,!1);i.addEventListener("touchend",l,!1)},v=function(){i.removeEventListener("touchstart",u);i.removeEventListener("touchmove",a);i.removeEventListener("touchend",l)};return{enable:d,disable:v,right:h,center:p}}(),c=function(){if(t.orientation===0){f.enable();n.body.classList.remove("landscape");n.body.classList.remove("left");n.body.classList.remove("right")}else{f.disable();l.position!=="center"&&l.center();n.body.classList.add("landscape");if(t.orientation>0){n.body.classList.remove("right");n.body.classList.add("left")}else{n.body.classList.remove("left");n.body.classList.add("right")}}},h=function(){var e,t=!1,r=!1;return{enable:function(){e=n.getElementById("notifications")},show:function(n,i){var s=n;i&&(s=" <b>"+i+"</b>&#8217;s "+s);if(!r){r=!0;t=!1;e.firstChild.innerHTML=s;e.classList.remove("hide");e.classList.add("show");setTimeout(this.hide(this),2e3)}else t=s},hide:function(n){return function(){r=!1;e.classList.remove("show");e.classList.add("hide");t&&setTimeout(function(){n.show(t)},500)}}}}(),p=function(){function u(e){var t=n.createElement("script"),i=!1;t.src=e;t.async=!0;t.onload=t.onreadystatechange=function(){if(!i&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){i=!0;t.onload=t.onreadystatechange=null;t&&t.parentNode&&t.parentNode.removeChild(t)}};r||(r=n.getElementsByTagName("head")[0]);r.appendChild(t)}function a(e){return encodeURIComponent(e)}function f(n,r,s,f){i=(n||"").indexOf("?")===-1?"?":"&";r=r||{};for(var l in r)r.hasOwnProperty(l)&&(i+=a(l)+"="+a(r[l])+"&");var c="json"+ ++e;t[c]=function(e){s(e);try{delete t[c]}catch(n){}t[c]=null};u(n+i+(f||o.callbackName||"callback")+"="+c);return c}function l(e){o=e}var e=0,r,i,s,o={};return{get:f,init:l}}();o()})(window,document);