var flibbble=function(){var a=document.getElementById("flipper"),b,c,d,e,f,g,h,i=1,j=function(){document.body.ontouchmove=function(a){a.preventDefault()};p();r.get("http://api.dribbble.com/shots/popular",{per_page:"20",page:"1"},function(a){k(a)})},k=function(c){var d=c.shots.length,e=document.createDocumentFragment(),f=0,g=3,h=function(){for(;f<d;f++){f===0&&e.appendChild(j(c.shots[0],g));f===d-1&&(d%2===0?e.appendChild(l(c.shots[d-1]),g):e.appendChild(l({},g)));if(f!==0&&f!==d-1){e.appendChild(k(c.shots[f],c.shots[f+1],g));f!==d-2&&f++}g--}},i=function(){a.appendChild(e);b=document.getElementsByClassName("page")},j=function(a,b){var c=document.createElement("div"),d=document.createElement("div"),e=document.createElement("img"),f=document.createElement("a");c.className="page first";c.style.zIndex=b;d.innerHTML="Loading";d.className="front shot";e.height=240;e.width=320;e.src=a.image_url;e.alt=a.title;d.appendChild(e);c.appendChild(d);return c},k=function(a,b,c){var d=document.createElement("div"),e=document.createElement("div"),f=document.createElement("div"),g=document.createElement("a"),h=document.createElement("a"),i=document.createElement("img"),j=document.createElement("img");d.className="page";e.className="front shot";e.innerHTML="Loading";f.className="back shot";f.innerHTML="Loading";i.height=240;i.width=320;j.height=240;j.width=320;i.src=a.image_url;i.alt=a.title;j.src=b.image_url;j.alt=b.title;c>0?d.style.zIndex=c:d.style.visibility="hidden";e.appendChild(i);f.appendChild(j);d.appendChild(e);d.appendChild(f);return d},l=function(a,b){var c=document.createElement("div"),d=document.createElement("div");c.className="page last";b<1&&(c.style.visibility="hidden");if(a.image_url&&a.title){var e=document.createElement("img"),f=document.createElement("a");d.className="front shot";d.innerHTML="Loading";e.height=240;e.width=320;e.src=a.image_url;e.alt=a.title;d.appendChild(e)}else{d.className="front text";d.innerHTML="END"}c.appendChild(d);return c};h();i()},l=function(){if(i>2){b[i-3].style.visibility="hidden";b[i-3].style.zIndex=""}if(i>1){b[i-2].style.zIndex=1;b[i-2].style.visibility=""}b[i-1].style.zIndex=2;b.length-i>1&&(b[i+1].style.zIndex=2);b.length-i>2&&(b[i+2].style.cssText="z-index: 1;");b.length-i>3&&(b[i+3].style.cssText="visibility: hidden;")},m=function(a){c=a.targetTouches[0].pageY;d=a.targetTouches[0].pageX;e=0;f=0;g=0;h=(new Date).getTime()},n=function(a){a.preventDefault();e=c-a.targetTouches[0].pageY;f=d-a.targetTouches[0].pageX;if(e>0){if(i<b.length-1){g=Math.min(Math.max((e-20)*.55,0),180);b[i].style.webkitTransition="";b[i].style.webkitTransform="rotateX("+g+"deg)";b[i].style.zIndex=3;if(i===1){b[0].style.webkitTransition="";b[0].style.webkitTransform=""}else b[i-1].style.webkitTransform="rotateX(180deg) translateZ(0)";l()}if(i===b.length-1){g=Math.min(-Math.log(e)*25+75,0);b[i].style.webkitTransition="";b[i].style.webkitTransform="rotateX("+ -g+"deg)"}}if(e<0){if(i!==1){g=Math.max(Math.min((340+e)*.55,180),0);b[i-1].style.webkitTransition="";b[i-1].style.webkitTransform="rotateX("+g+"deg)";b[i-1].style.zIndex=3}if(i===1){g=Math.min(-Math.log(-e)*25+75,0);b[0].style.webkitTransition="";b[0].style.webkitTransform="rotateX("+g+"deg)"}b[i].style.webkitTransform="rotateX(0deg)"}},o=function(a){var c=(new Date).getTime()-h;if(g<0&&e<0&&i===1){b[i-1].style.webkitTransition="all ease-out .6s";b[i-1].style.webkitTransform="rotateX(0deg) translateZ(0)"}if(g>=90&&e<0&&i!==1){b[i-1].style.webkitTransition="all ease-out .6s";b[i-1].style.webkitTransform="rotateX(180deg) translateZ(0)"}if((g>=90||c<300||c>300&&c<800&&e>100&&g<90)&&e>0&&i<b.length-1){b[i].style.webkitTransition="all ease-out .4s";b[i].style.webkitTransform="rotateX(180deg) translateZ(0)";i++}if(g<90&&e>0&&i!==b.length){b[i].style.webkitTransition="all ease-out .6s";b[i].style.webkitTransform="rotateX(0deg)"}if((g<90||c<300||c>300&&c<800&&e<-100&&g>90)&&e<0&&i!==1){b[i-1].style.webkitTransition="all ease-out .4s";b[i-1].style.webkitTransform="rotateX(0deg)";i--;l()}h=0},p=function(){a.addEventListener("touchstart",m,!1);a.addEventListener("touchmove",n,!1);a.addEventListener("touchend",o,!1)},q=function(){a.removeEventListener("touchstart",m);a.removeEventListener("touchmove",n);a.removeEventListener("touchend",o)},r=function(){function g(a){var c=document.createElement("script"),d=!1;c.src=a;c.async=!0;c.onload=c.onreadystatechange=function(){if(!d&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){d=!0;c.onload=c.onreadystatechange=null;c&&c.parentNode&&c.parentNode.removeChild(c)}};b||(b=document.getElementsByTagName("head")[0]);b.appendChild(c)}function h(a){return encodeURIComponent(a)}function i(b,d,i,j){c=(b||"").indexOf("?")===-1?"?":"&";d=d||{};for(var k in d)d.hasOwnProperty(k)&&(c+=h(k)+"="+h(d[k])+"&");var l="json"+ ++a;e[l]=function(a){i(a);try{delete e[l]}catch(b){}e[l]=null};g(b+c+(j||f.callbackName||"callback")+"="+l);return l}function j(a){f=a}var a=0,b,c,d,e=this,f={};return{get:i,init:j}}();return{init:j}}();document.addEventListener("DOMContentLoaded",flibbble.init);