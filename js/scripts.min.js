var flibbble=function(){var a=document.getElementById("flipper"),b,c=function(){document.body.ontouchmove=function(a){a.preventDefault()};d.enable();d.to("popular");f.enable();g.enable()},d=function(){var a="http://api.dribbble.com/shots/popular",b=!1,c=1,f=1,i,j=function(a){var b=this;if(a==="following"||a==="likes"){i=prompt("dribbble username:",i);if(i){this.url="http://api.dribbble.com/players/"+i+"/shots/"+a;h.get(this.url,{per_page:"20",page:"1"},function(a){e(a);b.page=1;b.maxpage=a.pages;g.center()})}}else{this.url="http://api.dribbble.com/shots/"+a;h.get(this.url,{per_page:"20",page:"1"},function(a){e(a);b.page=1;b.maxpage=a.pages;g.center()})}},k=function(){var a=document.getElementById("popular"),b=document.getElementById("following"),c=document.getElementById("likes"),e=document.getElementById("debuts"),f=document.getElementById("everyone");a.addEventListener("touchstart",function(a){d.to("popular")},!1);b.addEventListener("touchstart",function(a){d.to("following")},!1);c.addEventListener("touchstart",function(a){d.to("likes")},!1);e.addEventListener("touchstart",function(a){d.to("debuts")},!1);f.addEventListener("touchstart",function(a){d.to("everyone")},!1)},l=function(a){console.log(this.maxpage);if(!b&&this.page<this.maxpage){b=!0;h.get(this.url,{per_page:"20",page:++this.page},function(a){e(a);b=!1})}};return{to:j,enable:k,more:l,url:a}}(),e=function(c){var d=c.shots.length,e=document.createDocumentFragment(),g=0,h=3,i,j=function(){for(;g<d;g++){g===0&&c.page===1&&e.appendChild(m(c.shots[0],h));if(g===0&&c.page>1){i=p(c.shots[0]);h--}g===d-1&&(d%2===0?e.appendChild(o(c.shots[d-1]),h):e.appendChild(o({},h)));if(g!==0&&g!==d-1){e.appendChild(n(c.shots[g],c.shots[g+1],h));g!==d-2&&g++}h--}},k=function(){a.innerHTML="";f.reset();a.appendChild(e);b=document.getElementsByClassName("page")},l=function(){b[b.length-1].appendChild(i);b[b.length-1].classList.remove("last");a.appendChild(e);b=document.getElementsByClassName("page")},m=function(a,b){var c=document.createElement("div"),d=document.createElement("div"),e=document.createElement("img");c.className="page first";c.style.zIndex=b;d.innerHTML="Loading";d.className="front shot";e.height=240;e.width=320;e.src=a.image_url;e.alt=a.title;d.appendChild(e);c.appendChild(d);return c},n=function(a,b,c){var d=document.createElement("div"),e=document.createElement("div"),f=document.createElement("div"),g=document.createElement("img"),h=document.createElement("img");d.className="page";e.className="front shot";e.innerHTML="Loading";f.className="back shot";f.innerHTML="Loading";g.height=240;g.width=320;h.height=240;h.width=320;g.src=a.image_url;g.alt=a.title;h.src=b.image_url;h.alt=b.title;c>0?d.style.zIndex=c:d.style.visibility="hidden";e.appendChild(g);f.appendChild(h);d.appendChild(e);d.appendChild(f);return d},o=function(a,b){var c=document.createElement("div"),d=document.createElement("div");c.className="page last";b<1&&(c.style.visibility="hidden");if(a.image_url&&a.title){var e=document.createElement("img");d.className="front shot";d.innerHTML="Loading";e.height=240;e.width=320;e.src=a.image_url;e.alt=a.title;d.appendChild(e)}else{d.className="front text";d.innerHTML="END"}c.appendChild(d);return c},p=function(a){var b=document.createElement("img"),c=document.createElement("div");c.className="back shot";c.innerHTML="Loading";b.height=240;b.width=320;b.src=a.image_url;b.alt=a.title;c.appendChild(b);return c};if(c.page===1){j();k()}else{j();l()}},f=function(){var c,e,f,h,i,j,k=1,l=function(){if(k>2){b[k-3].style.visibility="hidden";b[k-3].style.zIndex=""}if(k>1){b[k-2].style.zIndex=1;b[k-2].style.visibility=""}b[k-1].style.zIndex=2;b.length-k>1&&(b[k+1].style.zIndex=2);b.length-k>2&&(b[k+2].style.cssText="z-index: 1;");b.length-k>3&&(b[k+3].style.cssText="visibility: hidden;")},m=function(a){c=a.targetTouches[0].pageY;e=a.targetTouches[0].pageX;f=0;h=0;i=0;j=(new Date).getTime()},n=function(a){a.preventDefault();f=c-a.targetTouches[0].pageY;h=e-a.targetTouches[0].pageX;if(f>0&&Math.abs(h)<Math.abs(f)){g.disable();if(k<b.length-1){i=Math.min(Math.max((f-20)*.55,0),180);b[k].style.webkitTransition="";b[k].style.webkitTransform="rotateX("+i+"deg)";b[k].style.zIndex=3;if(k===1){b[0].style.webkitTransition="";b[0].style.webkitTransform=""}else b[k-1].style.webkitTransform="rotateX(180deg) translateZ(0)"}if(k===b.length-1){i=Math.min(-Math.log(f)*25+75,0);b[k].style.webkitTransition="";b[k].style.webkitTransform="rotateX("+ -i+"deg)"}}if(f<0&&Math.abs(h)<Math.abs(f)){g.disable();if(k!==1){i=Math.max(Math.min((340+f)*.55,180),0);b[k-1].style.webkitTransition="";b[k-1].style.webkitTransform="rotateX("+i+"deg)";b[k-1].style.zIndex=3}if(k===1){i=Math.min(-Math.log(-f)*25+75,0);b[0].style.webkitTransition="";b[0].style.webkitTransform="rotateX("+i+"deg)"}b[k].style.webkitTransform="rotateX(0deg)"}},o=function(a){k===b.length-1&&d.more(k);var c=(new Date).getTime()-j;if(i<0&&f<0&&k===1){b[k-1].style.webkitTransition="all ease-out .6s";b[k-1].style.webkitTransform="rotateX(0deg) translateZ(0)"}if(i>=90&&f<0&&k!==1){b[k-1].style.webkitTransition="all ease-out .6s";b[k-1].style.webkitTransform="rotateX(180deg) translateZ(0)"}if((i>=90||c<300||c>300&&c<800&&f>100&&i<90)&&f>0&&k<b.length-1&&Math.abs(h)<Math.abs(f)){b[k].style.webkitTransition="all ease-out .4s";b[k].style.webkitTransform="rotateX(180deg) translateZ(0)";l();k++}if(i<90&&f>0&&k!==b.length){b[k].style.webkitTransition="all ease-out .6s";b[k].style.webkitTransform="rotateX(0deg)"}if((i<90||c<300||c>300&&c<800&&f<-100&&i>90)&&f<0&&k!==1&&Math.abs(h)<Math.abs(f)){b[k-1].style.webkitTransition="all ease-out .4s";b[k-1].style.webkitTransform="rotateX(0deg)";k--;l()}j=0;g.enable()},p=function(){a.addEventListener("touchstart",m,!1);a.addEventListener("touchmove",n,!1);a.addEventListener("touchend",o,!1)},q=function(){a.removeEventListener("touchstart",m);a.removeEventListener("touchmove",n);a.removeEventListener("touchend",o)},r=function(){k=1};return{enable:p,disable:q,reset:r}}(),g=function(){var b,c,d,e,g="center",h=function(a){b=a.targetTouches[0].pageY;c=a.targetTouches[0].pageX;d=0;e=0},i=function(a){a.preventDefault();d=b-a.targetTouches[0].pageY;e=c-a.targetTouches[0].pageX},j=function(a){g==="center"&&Math.abs(e)>Math.abs(d)&&e<-100&&k();g==="right"&&Math.abs(e)>Math.abs(d)&&e>0&&l()},k=function(){a.style.webkitTransform="translateX(240px) translateZ(0)";f.disable();g="right"},l=function(){a.style.webkitTransform="translateX(0px) translateZ(0)";f.enable();g="center"},m=function(){a.addEventListener("touchstart",h,!1);a.addEventListener("touchmove",i,!1);a.addEventListener("touchend",j,!1)},n=function(){a.removeEventListener("touchstart",h);a.removeEventListener("touchmove",i);a.removeEventListener("touchend",j)};return{enable:m,disable:n,right:k,center:l}}(),h=function(){function g(a){var c=document.createElement("script"),d=!1;c.src=a;c.async=!0;c.onload=c.onreadystatechange=function(){if(!d&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){d=!0;c.onload=c.onreadystatechange=null;c&&c.parentNode&&c.parentNode.removeChild(c)}};b||(b=document.getElementsByTagName("head")[0]);b.appendChild(c)}function h(a){return encodeURIComponent(a)}function i(b,d,i,j){c=(b||"").indexOf("?")===-1?"?":"&";d=d||{};for(var k in d)d.hasOwnProperty(k)&&(c+=h(k)+"="+h(d[k])+"&");var l="json"+ ++a;e[l]=function(a){i(a);try{delete e[l]}catch(b){}e[l]=null};g(b+c+(j||f.callbackName||"callback")+"="+l);return l}function j(a){f=a}var a=0,b,c,d,e=this,f={};return{get:i,init:j}}();return{init:c}}();document.addEventListener("DOMContentLoaded",flibbble.init);